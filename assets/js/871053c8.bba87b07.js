"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["88940"],{423121:function(e,t,n){n.r(t),n.d(t,{default:()=>p,frontMatter:()=>s,metadata:()=>r,assets:()=>a,toc:()=>c,contentTitle:()=>l});var r=JSON.parse('{"id":"data-operate/export/export-best-practice","title":"Best Practices","description":"\x3c!--","source":"@site/versioned_docs/version-3.0/data-operate/export/export-best-practice.md","sourceDirName":"data-operate/export","slug":"/data-operate/export/export-best-practice","permalink":"/docs/3.0/data-operate/export/export-best-practice","draft":false,"unlisted":false,"tags":[],"version":"3.0","frontMatter":{"title":"Best Practices","language":"en"},"sidebar":"docs","previous":{"title":"Using MySQL Dump","permalink":"/docs/3.0/data-operate/export/export-with-mysql-dump"},"next":{"title":"MySQL Compatibility","permalink":"/docs/3.0/query-data/mysql-compatibility"}}'),i=n("785893"),o=n("250065");let s={title:"Best Practices",language:"en"},l=void 0,a={},c=[{value:"SELECT INTO OUTFILE",id:"select-into-outfile",level:2},{value:"Export",id:"export",level:2}];function d(e){let t={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"This document mainly introduces how to determine whether resource utilization is reasonable during data export operations, and how to adjust resource utilization to achieve better data export efficiency."}),"\n",(0,i.jsx)(t.h2,{id:"select-into-outfile",children:"SELECT INTO OUTFILE"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Enable parallel export"}),"\n",(0,i.jsxs)(t.p,{children:["The number of rows returned by ",(0,i.jsx)(t.code,{children:"SELECT INTO OUTFILE"})," represents the number of parallel Writers. The more Writers, the higher the export concurrency, but the number of output files will also increase. If you find there is only one Writer, you can try enabling the parallel export feature."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"SET enable_parallel_outfile=true"})}),"\n",(0,i.jsxs)(t.p,{children:["After enabling, the ",(0,i.jsx)(t.code,{children:"SELECT INTO OUTFILE"})," operation generates the corresponding number of Writers based on the query's parallelism. The query parallelism is controlled by the session variable ",(0,i.jsx)(t.code,{children:"parallel_pipeline_task_num"}),". By default, it's half of the number of CPU cores per BE."]}),"\n",(0,i.jsx)(t.p,{children:"For example, in a cluster with 3 BE nodes, where each node has 8 CPU cores. When parallel export is enabled, it will generate (4*3=) 12 Writers."}),"\n",(0,i.jsxs)(t.p,{children:["Note that even if ",(0,i.jsx)(t.code,{children:"enable_parallel_outfile"})," is enabled, not all queries can be exported in parallel. For example, if the query contains global sorting and aggregation semantics, it cannot be exported in parallel. For example:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"SELECT * FROM table ORDER BY id;\n\nSELECT SUM(cost) FROM table;\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Determine export speed"}),"\n",(0,i.jsxs)(t.p,{children:["Each row result returned by ",(0,i.jsx)(t.code,{children:"SELECT INTO OUTFILE"})," contains the time (in seconds) and speed (in KB/s) of the corresponding Writer's output."]}),"\n",(0,i.jsx)(t.p,{children:"Adding up the speeds of multiple Writers on the same node gives you the write speed of a single node. You can compare this speed with disk bandwidth (e.g., when exporting to local) or network bandwidth (e.g., when exporting to object storage) to see if it has reached the bandwidth bottleneck."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"export",children:"Export"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Determine export execution status from the return results"}),"\n",(0,i.jsxs)(t.p,{children:["The Export command essentially breaks down the task into multiple ",(0,i.jsx)(t.code,{children:"SELECT INTO OUTFILE"})," clauses for execution."]}),"\n",(0,i.jsxs)(t.p,{children:["The results returned by the ",(0,i.jsx)(t.code,{children:"SHOW EXPORT"})," command contain a JSON string, which is a two-dimensional array. The first dimension represents the number of concurrent threads in Export, with the number of concurrent threads representing how many Outfile statements were initiated concurrently. The second dimension represents the return results of a single Outfile statement. Example:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'[\n    [\n        {\n            "fileNumber": "1",\n            "totalRows": "640321",\n            "fileSize": "350758307",\n            "url": "file:///127.0.0.1/mnt/disk2/ftw/tmp/export/exp_59fd917c43874adc-9b1c3e9cd6e655be_*",\n            "writeTime": "17.989",\n            "writeSpeed": "19041.66"\n        },\n        {...},\n        {...},\n        {...}\n    ],\n    [\n        {\n            "fileNumber": "1",\n            "totalRows": "646609",\n            "fileSize": "354228704",\n            "url": "file:///127.0.0.1/mnt/disk2/ftw/tmp/export/exp_c75b9d4b59bf4943-92eb94a7b97e46cb_*",\n            "writeTime": "17.249",\n            "writeSpeed": "20054.64"\n        },\n        {...},\n        {...},\n        {...}\n    ]\n]\n'})}),"\n",(0,i.jsx)(t.p,{children:"In the above example, 2 Outfile commands were initiated. Each command has 4 Writers writing concurrently."}),"\n",(0,i.jsxs)(t.p,{children:["By adjusting the ",(0,i.jsx)(t.code,{children:"parallelism"})," parameter in the Export command properties, you can control the number of concurrent Outfile operations, thereby controlling the concurrency level."]}),"\n"]}),"\n"]})]})}function p(e={}){let{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},250065:function(e,t,n){n.d(t,{Z:function(){return l},a:function(){return s}});var r=n(667294);let i={},o=r.createContext(i);function s(e){let t=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);